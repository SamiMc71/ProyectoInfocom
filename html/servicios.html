<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="icon" type="image/png" href="logoinfo.png">

  <title>Servicios Técnicos - INFOCOM</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="../css/cotizacion.css">
  <link rel="stylesheet" href="../css/servicio.css">
</head>
<body>
  <aside class="sidebar">
    <div class="sidebar-header">
      <img src="../logoinfo.png">
      <span>INFOCOM TECNOLOGY</span>
    </div>
    <div class="sidebar-menu">
      <a href="index.html" class="menu-item"><i class="fa-solid fa-chart-line"></i><span>Panel de Control</span></a>
      <a href="cliente.html" class="menu-item"><i class="fa-solid fa-users"></i><span>Ventas</span></a>
      <a href="servicios.html" class="menu-item active"><i class="fa-solid fa-gear"></i><span>Servicios Registrados</span></a>
      <a href="producto.html" class="menu-item"><i class="fa-solid fa-box"></i><span>Productos</span></a>
      <a href="cotizacion.html" class="menu-item"><i class="fa-solid fa-file-contract"></i><span>Cotizaciones</span></a>
      <a href="nuevaventa.html" class="menu-item"><i class="fa-solid fa-plus-circle"></i><span>Nueva Venta</span></a>
      <a href="reporte.html" class="menu-item"><i class="fa-solid fa-chart-pie"></i><span>Generador de reportes</span></a>
      <a href="admincuentas.html" class="menu-item"><i class="fas fa-user-cog"></i><span>Administración de Cuentas</span></a>
      <a href="papelera.html" class="menu-item"><i class="fa-solid fa-trash-can"></i><span>Papelera</span></a>
      
      <a href="#" class="menu-item" id="logout-btn"><i class="fa-solid fa-right-from-bracket"></i><span>Cerrar Sesión</span></a>
    </div>
  </aside>

  <main class="main-content">
    <div class="header">
      <h1>Servicios Técnicos Registrados</h1>
      <div class="header-actions">
        <button class="btn btn-primary" onclick="openModal('modal-nuevo')">
          <i class="fa-solid fa-plus"></i> Nuevo Servicio
        </button>
      </div>
    </div>

    <div class="filters-container">
      <div class="search-box">
        <input type="text" id="search-input" placeholder="Buscar por cliente, equipo o problema...">
        <i class="fa-solid fa-search"></i>
      </div>
      <div class="filter-row-secondary" id="secondary-filters-row">
        <div class="filter-group-super-user" id="services-super-user-filters" style="display: none;">
          <select class="filter-select" id="services-user-filter">
              <option value="all">Todos los Técnicos/Vendedores</option>
              </select>
        </div>
        <select class="filter-select" id="status-filter">
          <option value="all">Todos los estados</option>
          <option value="pendiente">Pendiente</option>
          <option value="en-proceso">En proceso</option>
          <option value="completado">Completado</option>
          <option value="entregado">Entregado</option>
        </select>
        <select class="filter-select" id="date-filter">
          <option value="all">Todas las fechas</option>
          <option value="today">Hoy</option>
          <option value="week">Esta semana</option>
          <option value="month">Este mes</option>
        </select>
      </div>
      </div>

    <div class="table-container">
      <div class="table-loading" id="table-loading">
        <i class="fa-solid fa-spinner fa-spin"></i>
        <span>Cargando servicios desde la base de datos...</span>
      </div>
      <table id="servicios-table" style="display: none;">
        <thead>
          <tr>
            <th>ID</th>
            <th>Cliente</th>
            <th>Equipo</th>
            <th>Problema</th>
            <th>Total</th>
            <th>Estado</th>
            <th>Fecha Ingreso</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody id="servicios-body">
          </tbody>
      </table>
      <div class="table-empty" id="table-empty" style="display: none;">
        <i class="fa-solid fa-inbox"></i>
        <p>No hay servicios registrados</p>
        <button class="btn btn-primary" onclick="openModal('modal-nuevo')" style="margin-top: 15px;">
          <i class="fa-solid fa-plus"></i> Registrar Primer Servicio
        </button>
      </div>
    </div>
  </main>

  <div class="modal" id="modal-detalles">
    <div class="modal-content modal-detalles-content">
      <span class="btn-close" onclick="cerrarModal('modal-detalles')">&times;</span>
      <h2>Detalles del Servicio <span id="detalle-id"></span></h2>
      <div class="detalles-content" id="detalles-content">
        </div>
      <div class="modal-buttons">
        <button class="btn-cancel" onclick="cerrarModal('modal-detalles')">Cerrar</button>
        <button class="btn btn-secondary" style="background-color: #3498db;" onclick="generarComprobante('a4')">
          <i class="fa-solid fa-print"></i> Imprimir A4
        </button>
        <button class="btn btn-primary" onclick="generarComprobante('pos58')">
          <i class="fa-solid fa-receipt"></i> Ticket 58mm
        </button>
        <button class="btn btn-primary" style="background-color: #2c3e50;" onclick="generarComprobante('pos80')">
          <i class="fa-solid fa-receipt"></i> Ticket 80mm
        </button>
        
        <button class="btn-whatsapp" onclick="enviarServicioPorWhatsApp('58')">
          <i class="fa-brands fa-whatsapp"></i> 58mm (PDF)
        </button>
        <button class="btn-whatsapp" style="background-color: #128C7E;" onclick="enviarServicioPorWhatsApp('80')">
          <i class="fa-brands fa-whatsapp"></i> 80mm (PDF)
        </button>
      </div>
    </div>
  </div>

  <div class="modal" id="modal-editar">
    <div class="modal-content modal-editar-content">
      <span class="btn-close" onclick="cerrarModal('modal-editar')">&times;</span>
      <h2 class="modal-title">Editar Servicio</h2>
      
      <form id="edit-form">
        <input type="hidden" id="edit-servicio-id">
        <div class="form-section">
          <h3 class="section-title">Información del Cliente</h3>
          <div class="form-row">
            <div class="form-group form-group-flex">
              <label>Tipo Documento</label>
              <select id="edit-tipo-doc" class="form-select">
                <option value="DNI">DNI</option>
                <option value="RUC">RUC</option>
                <option value="CE">Carnet Extranjería</option>
              </select>
            </div>
            <div class="form-group form-group-flex-2">
              <label>Número Documento</label>
              <input type="text" id="edit-num-doc" required class="form-input">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group form-group-flex-2">
              <label>Nombres Completos / Razón Social</label>
              <input type="text" id="edit-cliente" required class="form-input">
            </div>
            <div class="form-group form-group-flex">
              <label>Teléfono</label>
              <input type="text" id="edit-telefono" class="form-input">
            </div>
          </div>
        </div>

        <div class="form-section">
          <h3 class="section-title">Información del Equipo</h3>
          <div class="form-row">
            <div class="form-group form-group-flex">
              <label>Tipo de Equipo</label>
              <select id="edit-tipo-equipo" class="form-select">
                <option value="Laptop">Laptop</option>
                <option value="PC Escritorio">PC Escritorio</option>
                <option value="Impresora">Impresora</option>
                <option value="Monitor">Monitor</option>
                <option value="Otro">Otro</option>
              </select>
            </div>
            <div class="form-group form-group-flex-2">
              <label>Nombre del Equipo (Marca/Modelo)</label>
              <input type="text" id="edit-nombre-equipo" required class="form-input" placeholder="Ej: Laptop HP 15-dw...">
            </div>
          </div>
          <div class="form-group">
            <label>Problema Reportado</label>
            <textarea id="edit-problema" rows="3" required class="form-input"></textarea>
          </div>
          <div class="form-group">
            <label>Fecha de Ingreso</label>
            <input type="date" id="edit-fecha-ingreso" required class="form-input">
        </div>
        </div>

        <div class="form-section">
          <h3 class="section-title">Productos Utilizados</h3>
          <div class="add-product-section" style="background: #fdfdfd; padding: 10px; border-radius: 8px;">
            <div class="form-row">
              <div class="form-group" style="flex: 3;">
                <label>Buscar Producto</label>
                <div class="searchable-select">
                  <input type="text" id="edit-product-search" placeholder="Escriba para buscar productos...">
                  <div class="dropdown" id="edit-product-dropdown"></div>
                </div>
              </div>
              <div class="form-group" style="flex: 1;">
                <label>Cantidad</label>
                <input type="number" id="edit-product-quantity" min="1" value="1" class="form-input">
              </div>
              <div class="form-group" style="display: flex; align-items: flex-end;">
                <button type="button" class="btn btn-primary" onclick="agregarProductoServicio('edit')">
                  <i class="fa-solid fa-plus"></i> Agregar
                </button>
              </div>
            </div>
          </div>
          <table class="products-table">
            <thead>
              <tr>
                <th>Producto</th>
                <th>Cant.</th>
                <th>P. Unit.</th>
                <th>Subtotal</th>
                <th>Acción</th>
              </tr>
            </thead>
            <tbody id="edit-products-body">
              </tbody>
          </table>
        </div>

        <div class="form-section">
            <h3 class="section-title">Costos y Facturación</h3>
            <div class="form-row">
                <div class="form-group form-group-flex">
                    <label>Mano de Obra (Costo Servicio)</label>
                    <input type="number" id="edit-costo-servicio" class="form-input" value="0.00" step="0.01" min="0" oninput="actualizarTotalServicio('edit')">
                </div>
                <div class="form-group form-group-flex">
                    <label>Estado del Servicio</label>
                    <select id="edit-estado" class="form-select">
                        <option value="pendiente">Pendiente</option>
                        <option value="en-proceso">En proceso</option>
                        <option value="completado">Completado</option>
                        <option value="entregado">Entregado</option>
                    </select>
                </div>
            </div>
            
            <div class="form-group">
                <label>Tipo de Comprobante</label>
                <div class="comprobante-options">
                    <input type="radio" name="edit-comprobante" value="boleta" id="edit-tipo-boleta" checked style="display: none;">
                    <label for="edit-tipo-boleta"><i class="fa-solid fa-receipt"></i> Boleta (Sin IGV)</label>
                    
                    <input type="radio" name="edit-comprobante" value="factura" id="edit-tipo-factura" style="display: none;">
                    <label for="edit-tipo-factura"><i class="fa-solid fa-file-invoice-dollar"></i> Factura (Con IGV)</label>
                </div>
            </div>
            
            <div class="form-row-totales">
                <div class="total-group">
                   <label>Subtotal Productos:</label>
                   <span id="edit-subtotal-productos">S/ 0.00</span>
                </div>
                <div class="total-group">
                   <label>Mano de Obra:</label>
                   <span id="edit-total-servicio">S/ 0.00</span>
                </div>
                <div class="total-group total-final">
                   <label>Total:</label>
                   <span id="edit-total-final">S/ 0.00</span>
                </div>
            </div>
        </div>

        <div class="modal-buttons modal-buttons-editar">
          <button type="button" class="btn-cancel" onclick="cerrarModal('modal-editar')">
            Cancelar
          </button>
          <button type="submit" class="btn-save">
            <i class="fa-solid fa-floppy-disk"></i> Guardar Cambios
          </button>
        </div>
      </form>
    </div>
  </div>

  <div class="modal" id="modal-eliminar">
    <div class="modal-content">
      <span class="btn-close" onclick="cerrarModal('modal-eliminar')">&times;</span>
      <h2>¿Está seguro de eliminar este servicio?</h2>
      <p id="delete-message">Esta acción no se puede deshacer.</p>
      <div class="modal-buttons">
        <button class="btn-cancel" onclick="cerrarModal('modal-eliminar')">Cancelar</button>
        <button class="btn-confirm" id="confirm-delete">Eliminar</button>
      </div>
    </div>
  </div>

  <div class="modal" id="modal-nuevo">
    <div class="modal-content modal-nuevo-content">
      <span class="btn-close" onclick="cerrarModal('modal-nuevo')">&times;</span>
      <h2>Nuevo Servicio Técnico</h2>
      <form id="nuevo-form">
        <div class="form-section">
          <h3 class="section-title">Información del Cliente</h3>
          <div class="form-row">
            <div class="form-group form-group-flex">
              <label>Tipo Documento</label>
              <select id="nuevo-tipo-doc" class="form-select">
                <option value="DNI">DNI</option>
                <option value="RUC">RUC</option>
                <option value="CE">Carnet Extranjería</option>
              </select>
            </div>
            <div class="form-group form-group-flex-2">
              <label>Número Documento</label>
              <input type="text" id="nuevo-num-doc" required class="form-input">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group form-group-flex-2">
              <label>Nombres Completos / Razón Social</label>
              <input type="text" id="nuevo-cliente" required class="form-input">
            </div>
            <div class="form-group form-group-flex">
              <label>Teléfono</label>
              <input type="text" id="nuevo-telefono" class="form-input">
            </div>
          </div>
        </div>

        <div class="form-section">
          <h3 class="section-title">Información del Equipo</h3>
          <div class="form-row">
            <div class="form-group form-group-flex">
              <label>Tipo de Equipo</label>
              <select id="nuevo-tipo-equipo" class="form-select">
                <option value="Laptop">Laptop</option>
                <option value="PC Escritorio">PC Escritorio</option>
                <option value="Impresora">Impresora</option>
                <option value="Monitor">Monitor</option>

                <option value="Otro">Otro</option>
              </select>
            </div>
            <div class="form-group form-group-flex-2">
              <label>Nombre del Equipo (Marca/Modelo)</label>
              <input type="text" id="nuevo-nombre-equipo" required class="form-input" placeholder="Ej: Laptop HP 15-dw...">
            </div>
          </div>
          <div class="form-group">
            <label>Problema Reportado</label>
            <textarea id="nuevo-problema" rows="3" required class="form-input"></textarea>
          </div>
          <div class="form-group">
            <label>Fecha de Ingreso</label>
            <input type="date" id="nuevo-fecha-ingreso" required class="form-input">
          </div>
        </div>

        <div class="form-section">
          <h3 class="section-title">Productos Utilizados</h3>
          <div class="add-product-section" style="background: #fdfdfd; padding: 10px; border-radius: 8px;">
            <div class="form-row">
              <div class="form-group" style="flex: 3;">
                <label>Buscar Producto</label>
                <div class="searchable-select">
                  <input type="text" id="nuevo-product-search" placeholder="Escriba para buscar productos...">
                  <div class="dropdown" id="nuevo-product-dropdown"></div>
                </div>
              </div>
              <div class="form-group" style="flex: 1;">
                <label>Cantidad</label>
                <input type="number" id="nuevo-product-quantity" min="1" value="1" class="form-input">
              </div>
              <div class="form-group" style="display: flex; align-items: flex-end;">
                <button type="button" class="btn btn-primary" onclick="agregarProductoServicio('nuevo')">
                  <i class="fa-solid fa-plus"></i> Agregar
                </button>
              </div>
            </div>
          </div>
          <table class="products-table">
            <thead>
              <tr>
                <th>Producto</th>
                <th>Cant.</th>
                <th>P. Unit.</th>
                <th>Subtotal</th>
                <th>Acción</th>
              </tr>
            </thead>
            <tbody id="nuevo-products-body">
              </tbody>
          </table>
        </div>
        
        <div class="form-section">
            <h3 class="section-title">Costos y Facturación</h3>
            <div class="form-row">
                <div class="form-group form-group-flex">
                    <label>Mano de Obra (Costo Servicio)</label>
                    <input type="number" id="nuevo-costo-servicio" class="form-input" value="0.00" step="0.01" min="0" oninput="actualizarTotalServicio('nuevo')">
                </div>
                <div class="form-group form-group-flex">
                    <label>Estado del Servicio</label>
                    <select id="nuevo-estado" class="form-select">
                        <option value="pendiente">Pendiente</option>
                        <option value="en-proceso">En proceso</option>
                        <option value="completado">Completado</option>
                        <option value="entregado">Entregado</option>
                    </select>
                </div>
            </div>
            
            <div class="form-group">
                <label>Tipo de Comprobante</label>
                <div class="comprobante-options">
                    <input type="radio" name="nuevo-comprobante" value="boleta" id="nuevo-tipo-boleta" checked style="display: none;">
                    <label for="nuevo-tipo-boleta"><i class="fa-solid fa-receipt"></i> Boleta (Sin IGV)</label>

                    <input type="radio" name="nuevo-comprobante" value="factura" id="nuevo-tipo-factura" style="display: none;">
                    <label for="nuevo-tipo-factura"><i class="fa-solid fa-file-invoice-dollar"></i> Factura (Con IGV)</label>
                </div>
            </div>
            
            <div class="form-row-totales">
                <div class="total-group">
                   <label>Subtotal Productos:</label>
                   <span id="nuevo-subtotal-productos">S/ 0.00</span>
                </div>
                <div class="total-group">
                   <label>Mano de Obra:</label>
                   <span id="nuevo-total-servicio">S/ 0.00</span>
                </div>
                <div class="total-group total-final">
                   <label>Total:</label>
                   <span id="nuevo-total-final">S/ 0.00</span>
                </div>
            </div>
        </div>


        <div class="modal-buttons">
          <button type="button" class="btn-cancel" onclick="cerrarModal('modal-nuevo')">Cancelar</button>
          <button type="submit" class="btn-save">Guardar Servicio</button>
        </div>
      </form>
    </div>
  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script src="../javascript/auth.js"></script>
  <script src="../javascript/servicios.js"></script>
</body>
</html>